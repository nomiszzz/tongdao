{% extends "base.html" %}
{% block title %}奖品{% end %}
{% block style %}
<link rel="stylesheet" href="http://7xkf6a.com2.z0.glb.qiniucdn.com/css/index-ddea3887ce.css">
{% end %}

{% block script %}
<script type="text/javascript" src="/static/js/slider-H5.js"></script>
{% end %}


{% block main %}
<div class="eventGround">
  <div class="contain">
    <img src="/static/images/pic32.jpg">
    <a class="back" href="/home"><img src="/static/images/back.png"></a>
  </div>
  <div class="contain" id="change">
    <div class="imgBox">
      <ul>
      {% for bn in banners %}
      <li><img src="{{ bn['image'] }}"></li>
      {% end %}
      </ul>
    </div>
  </div>

  <img src="/static/images/pic34.jpg">
  <div class="contain">
    <img src="/static/images/pic35.jpg">
    <ul class="prolist">
      {% for ad in awards %}
      <li data-provide="{{ ad['provide'] }}" data-aid="{{ ad['id'] }}">

        <div class="proDetial">
          <strong>{{ ad['provide'] }}</strong>{{ ad['name'] }}
          <span class="cost"><em>{{ ad['score'] }}</em>点</span>
        </div>
        <img src="{{ ad['image'] }}">
      </li>
      {% end %}
    </ul>
  </div>
</div>
<div class="window">
  <div class="shadow"></div>
  <div class="textBox">
    <div>
      <span class="name"></span>
      奖品说明<br>
      这里是说明这里是说明这里是说明这里是说明这里是说明这里是说明
      <p class="score">点击兑换后会扣除xxx点数哦！</p>
      <span class="cost"><img src="/static/images/cost.png"></span>
    </div>
    <div style="display: none;">
      <p class="code">兑换码：666666</p>
      <span class="close cost">ok</span>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function () {

    $(".prolist li").bind("click", function () {
      var score = parseInt($(this).find('em').text());
      aid = $(this).attr('data-aid');

      // 请求兑换接口
      $.ajax({
        async: true,
        url: "/awards/" + aid,
        type: 'post',
        success: function (resp){
          $(".textBox .score").text('点击兑换后会扣除' + score + '点数哦！');
          $(".textBox .name").text('活动奖品有' + resp.provide + '商家提供');
          $(".textBox p").text('兑换码：' + resp.award_code);
          $(".window").show();
        },
        error: function(XMLHttpResponse, textStatus){
          console.log(XMLHttpResponse)
          var status_code = XMLHttpResponse.status;
          if (status_code == 403){
            window.location = '/auth/signin';
          }
          var body = JSON.parse(XMLHttpResponse.responseText);
          alert(body.msg)
        }
      })
    });

    $(".textBox .cost").bind("click", function () {
      $(this).parent().hide();
      $(this).parent().next().show();
    });
    $(".close").bind("click", function () {
      $(".window").hide();
      $(".textBox").find("div").eq(0).show();
      $(".textBox").find("div").eq(1).hide();
    });

    /*轮播*/
    var scrollImg = $.mggScrollImg('.imgBox ul',{
        loop : true,
        auto : true,
        auto_wait_time:3000,
        scroll_time:300,
        callback : function(ind){
            $('#page').text(ind+1);
        }
    });
  });
</script>
{% end %}